<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../polymer-tile/polymer-tile.html">
<link rel="import" href="../core-animated-pages/core-animated-pages.html">

<!--
polymer-tile-window

##### Example

    <polymer-tile-window fit>
      <polymer-tile> 
        <tile>
          <tile style="background: yellow;"></tile>
          <tile style="background: red;" linkto="popup2"></tile>
        </tile>
        <tile style="background: orange;" linkto="popup1"></tile>
        <tile double style="background: purple;"></tile>
      </polymer-tile>
      <window id="popup1" fit style="background: orange;">
        <button closeButton>close</button>
      </window>
      <window id="popup2" fit style="background: red;">
        <button closeButton>close</button>
      </window>
    </polymer-tile-window>

@element polymer-tile-window
@extends core-animated-pages
@blurb polymer-tile-window.
@status alpha
@homepage https://github.com/teaegg/polymer-tile-window
-->
<polymer-element name="polymer-tile-window" extends="core-animated-pages"
  valueattr="id">

  <template>

      <shadow></shadow>

  </template>

  <script>
    Polymer({

      ready: function() {
        this._tileClickHandler = this.tileClickHandler.bind(this);
        this._restore = this.restore.bind(this);
        // this.$.tileContainer.setup();
        this.content = this.$.items.getDistributedNodes();
        this.registerHandler();
        this.super();
      },

      detached: function() {
        // Remove listener
        // this.removeEventListener('mousewheel', this._scrollHandler);
        this.detaching = true;
        this.registerHandler();
        this.super();
      },

      tileClickHandler: function(e) {
        this.selected = e.currentTarget.getAttribute('linkto');
      },

      /**
      * Navigate to the startup page.
      *
      * @method restore
      * @param none
      * @return none
      */
      restore: function(e) {
        this.selected = 0;
      },
      
      registerHandler: function() {
        for(var i = 0; i < this.content.length; i++) {
          if(this.content[i].localName == 'window') {
            var closeBtn = this.content[i].querySelector('[closeButton]');
            if(closeBtn) {
              if(this.detaching)
                closeBtn.removeEventListener('click', this._restore);
              else
                closeBtn.addEventListener('click', this._restore);
            }
          } else if(this.content[i].localName = 'polymer-tile') {
            this.tiles = this.content[i].tiles;
          }
        }

        for(var i = 0; i < this.tiles.length; i++) {
          if(this.tiles[i].attributes.linkto) {
            if(this.detaching)
              this.tiles[i].removeEventListener('click', this._tileClickHandler);
            else
              this.tiles[i].addEventListener('click', this._tileClickHandler);
          }
        }
      },

    });

  </script>

</polymer-element>
